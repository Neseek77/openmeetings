<?xml version="1.0" encoding="UTF-8" ?>
<library>
	

<resource name="chatbgitemau" src="resources/bgitemvideochat.swf" />

<resource name="showusercontextcloseau" src="resources/error.png" />
<resource name="showusercontextau" src="resources/1downarrow.png" />
	

<!-- #################
	Class videoobject
	
	Constructor: non
	
	Attributes:
	String chatpartnername
	int chatpartnername
 -->
    
<class name="videoobjectaudience" extends="view" bgcolor="0x000000" width="252" height="270" visible="true">
		
	<!-- Set the Name of the partner -->
	<attribute name="chatpartnername" value="" type="string" />
	
	<attribute name="usercolor" value="" type="string" />
	<attribute name="userposition" value="o" type="number" />
		
	<!-- Set the ID of the Partner 
		@keywords private
	 -->
	<attribute name="uniqueid" value="-2" type="string" />
	
	<attribute name="isremote" value="true" type="boolean" />
	
	<attribute name="clientVars" value="null" />
	
	<handler name="oninit">
		this.clientVars = new Array();
		this.clientVars['User']='No User Connected';
	</handler>
	
	<!-- Get the reference to the videoview-Object -->
	<method name="getVideoReference">
		return this._chatvideoinner._videoview;
	</method>
    
    <method name="setIdentifier" args="id">
    	//for development replace this by the real name later after authentification
    	//this.setAttribute('chatpartnername',('StreamID: '+id));
        this.uniqueid = id;
    </method>
    
    <method name="resetValues">
    	this.uniqueid = '0';
    	this.setAttribute('chatpartnername','');
    	this.clientVars=null;
    </method>
    
	<!-- Attribute shows if an Video-Stream has been assigned to this videoview 
		if it has been assigned one then no other can connect -->
	<attribute name="isassigned" value="false" type="boolean" />
		
	<view name="_innertop" width="250" height="18" x="1" y="1" bgcolor="$once{ canvas.basebgcolorizer }">
  		<text text="${ parent.parent.chatpartnername }" width="166" fgcolor="white"
  			fontsize="10" fontstyle="bold" />
	</view>

	<view name="_chatvideoinner" x="1" y="20" width="126" resource="chatbgitemau" height="180" >
		
		<handler name="oninit">
			this.setResourceNumber(5);
		</handler>
		
		<!-- This is the videoview  -->
		<videoview name="_videoview" visible="false" x="5" width="240" height="180" y="0" >
	        <mediastream name="v_output" debug="true" type="rtmp" >
	            <handler name="onurl">
	                Debug.write("stream onurl ",this);
					Debug.write("stream onurl 2 ",this.url);
	                //this.parent.play(-1,false);
	            </handler>
	        </mediastream>
            <camera name="cameraRef" show="false" width="240" height="180" fps="30" />
            <microphone name="microphoneRef" capturing="false">         
            	<handler name="onlevel">
            		this.parent.parent.parent._loadness.setLevel(this.level);
            	</handler>
            </microphone>
		</videoview>

	</view>
	
	<view name="_loadness" x="1" width="$once{ parent.width-2 }" height="69" y="200" bgcolor="0xFFFFFF">
		<method name="setLevel" args="ll">
			this._loudness.setAttribute('frame',Math.round(ll/4));
		</method>
		<view x="2" y="2" name="_loudness" resource="loudnessBig" bgcolor="0xFFFFFF">
			<handler name="oninit">
				Debug.write("this: ",this);
				this.setAttribute('frame',1);
			</handler>
		</view>
	</view>
	
	<view x="$once{ parent.width-20 }" y="2" resource="messagebox_info_rsc" 
		onmouseover="" onmouseup="" visible="${ ( (!parent.isremote) ? true : false ) }">
		<handler name="onclick">
			new changedevice(canvas.main_content._content.inner);
		</handler>
		<labeltooltip inittwice="true" labelid="57" />
	</view>
	
	<view x="$once{ parent.width-20 }" y="2" name="infoview" resource="showusercontextau"
		onmouseover="" onmouseup="" visible="${ ( (!parent.isremote) ? false : true ) }">
		<handler name="onclick">
			parent.infostuff.initUserObject();
		</handler>
		<labeltooltip inittwice="true" labelid="68" />
	</view>
	
	<view visible="false" name="infostuff" width="$once{ parent.width-2 }" 
		height="$once{ parent.height-41 }" y="20" x="1" bgcolor="white">
		<method name="initUserObject">
			<![CDATA[
			this.setAttribute('visible',true);
			var tString = '';
			Debug.write("clientVars: ",parent.clientVars);
			for (var eg in parent.clientVars){
				if (eg!='userip'){
					tString += eg+': <BR/>'+parent.clientVars[eg]+'<BR />';
				} else {
					tString += eg+': <BR/>'+parent.clientVars[eg]+'<BR />';
					tString += 'WHOIS:<BR/>';
					tString += '<A HREF="http://www.networksolutions.com/whois/results.jsp?whoistoken='+parent.clientVars[eg]+'" TARGET="_BLANK">'+parent.clientVars[eg]+'</A><BR/><BR/>';
				}
			}
			Debug.write("tString: ",tString);
			this.inner._usertext.setText(tString);
			]]>
		</method>
		<view x="$once{ parent.width-20 }" y="2" name="infoview" resource="showusercontextcloseau">
			<handler name="onclick">
				parent.setAttribute('visible',false);
			</handler>
			<labeltooltip inittwice="true" labelid="85" />
		</view>	
		<view name="inner" width="$once{ parent.width }" 
			height="$once{ parent.height-20 }" y="20" clip="true">
			<text name="_usertext" width="$once{ parent.width }" multiline="true" />
			<vscrollbar />
		</view>
	</view>
</class>

</library>
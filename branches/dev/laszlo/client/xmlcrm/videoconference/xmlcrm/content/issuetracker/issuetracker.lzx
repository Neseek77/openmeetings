<?xml version="1.0" encoding="UTF-8" ?>
<library>
	
<class name="issuetree" extends="tree" >
	<attribute name="isrootItem" value="false" type="boolean" />
	<handler name="onclick">
		issuecontentareaRoot.setCurrentPath(this);
	</handler>
	<method name="clearSubs">
		for (var eg in this.children.subviews){
			this.children.subviews[eg].destroy();
		}
	</method>	
</class>
	
<class name="issuetreeproject" extends="issuetree">
	<attribute name="isproject" value="false" type="boolean" />
	<attribute name="projectid" value="0" type="number" />
	
	<handler name="onclick">
		Debug.write("projectid: ",this.projectid);
		this.getIssuesForProject.doCall();
	</handler>
	
	<netremotecallhib name="getIssuesForProject" funcname="issueservice.getIssuesForProject" 
		remotecontext="$once{ canvas.thishib }" >   
		<netparam name="vars2"><method name="getValue">return this.parent.parent.projectid;</method></netparam>  
		<handler name="ondata" args="value">	
			Debug.write("getIssuesForProject: ",value);
			<![CDATA[
				Debug.write("this: ",this);
				this.parent.clearSubs();
				for (var i=0;i<value.length;i++){
					new issuestreeissue(this.parent,{text:value[i].title,isissue:true,issuesid:value[i].id,objRef:value[i]});
				}
			]]>	        	          				
		</handler>	
	</netremotecallhib>  	
		
</class>
	
<class name="issuestreeissue" extends="issuetree">
	<attribute name="isissue" value="false" type="boolean" />
	<attribute name="issuesid" value="0" type="number" />
	<attribute name="objRef" value="null" />
	
	
</class>

<class name="issuetracker" extends="basecontentview">	
	
	
	<labeltext fontstyle="bold" y="10" text="Projects" />
	
			<handler name="oninit">
    			this.getProjects.doCall();
    		</handler>
	
		  	<netremotecallhib name="getProjects" funcname="issueservice.getProjects" 
				  remotecontext="$once{ canvas.thishib }" >   
		        <handler name="ondata" args="value">	
					Debug.write("getProjects: ",value);
	                <![CDATA[
	                for (var i=0;i<value.length;i++){
						new issuetreeproject(parent._contenttree.inner.rootProjekt,{isproject:true,projectid:value[i].id,text:value[i].title});
					}
	                ]]>	        	          				
		        </handler>	
		  	</netremotecallhib>   
		
	<view name="_contenttree" width="300" height="400" clip="true" y="40">
		<view name="inner">
			<issuetree showroot="true" open="true" focused="true" text="Projects" 
				isrootItem="true" name="rootProjekt" />
		</view>
		<hscrollbar />
		<vscrollbar />
	</view>
	
	<view name="_content" id="issuecontentareaRoot" x="302" y="40">
		
		<attribute name="currentNode" value="null" />
		<attribute name="path" type="string" value="" />
		<attribute name="parrentNodes" value="null" />
		
		<method name="setCurrentPath" args="obj">
			this.currentNode = obj;
			this.path = '';
			this.parrentNodes = new Array();
			this.calcCurrentPath(obj);
		</method>
		
		<method name="calcCurrentPath" args="obj">
			<![CDATA[
				this.parrentNodes.push(obj.text+'/');
				if (obj.isrootItem){
					this.arrayToPath();
				} else {
					this.calcCurrentPath(obj.parent);
				}
			]]>
		</method>
		<method name="arrayToPath">
			<![CDATA[
				for (var i=this.parrentNodes.length;i>0;i--){
					this.path += this.parrentNodes[i-1];
				}
				this.currentPath.setText(this.path);
			]]>
		</method>
		
		<labeltext name="currentPath" y="10" text="/" />
		
	</view>
		
</class>

</library>